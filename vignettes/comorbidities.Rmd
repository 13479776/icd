---
title: "Comorbidity mappings"
author: "Jack O. Wasey"
date: "Saturday, January 24, 2015"
output: html_document
---
<!---
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Introducing icd9}
--->
```{r setup, eval=TRUE, echo=FALSE, cache=FALSE}
suppressWarnings({
  suppressMessages({
    library(knitr, warn.conflicts = FALSE)
    library(icd9, warn.conflicts = FALSE)
    library(magrittr, warn.conflicts = FALSE)
  })
})

opts_chunk$set(cache = TRUE) # unless otherwise stated

patientData <- data.frame(
  visitId = c(1000, 1000, 1000, 1000, 1001, 1001, 1002),
  icd9 = c("402010", "27801", "7208", "25001", "34400", "4011", "4011"),
  poa = factor(c("Y", "Y", "N", "Y", "N", "Y", "N"))
)
```

## Comorbidities
The comorbidities from different sources are provided as lists. At present only the most recent mapping of ICD-9 codes to comorbidities is provided. See \url{https://github.com/jackwasey/icd9/issues/6} and \url{https://github.com/jackwasey/icd9/issues/7}.

This package contains ICD-9-CM to co-morbidity mappings from several sources, based on either the Charlson or Elixhauser lists of co-morbidities. Updated versions of these lists from [AHRQ](http://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp) and [Quan et al](http://www.ncbi.nlm.nih.gov/pubmed/16224307) are included, along with the original Elixhauser mapping . Since some data is provided in SAS source code format, this package contains functions to parse this SAS source code and generate R data structures. This processing is limited to what is needed for this purpose, although may be generalizable and useful in other contexts. Other lists are transcribed directly from the published articles, but interpretation of SAS code from the publication author is preferred.

A function is provided to compare comorbidity mappings, and show the differences.
```{r diffcomorbid}
# compare the first five comorbidities on these mappings
icd9DiffComorbid(ahrqComorbid[1:5], elixComorbid[1:5])
```

### AHRQ comorbidity classification

The AHRQ keeps an updated version of the Elixhauser classification of ICD-9-CM codes into comorbidities, useful for research. They provide the data in the form of SAS code. This package provides just enough code to parse the SAS source code provided by the AHRQ (but probably not much other SAS code), and generate a list of ICD-9 codes for each comorbidity.

```{r ahrq, eval=FALSE}
ahrqComorbid <- parseAhrqSas()
head(summary(ahrqComorbid))
```
The icd9Condense functions can be used to make a minimal set of parent codes which describes each group:
```{r "condenseMapping"}
lapply(ahrqComorbid[c("Obesity", "Depression")], icd9CondenseToMajorShort, onlyReal = TRUE)
ahrqComorbid[c("Obesity", "Depression")] %>% icd9ExplainShort(doCondense = FALSE)
```

## Elixhauser co-morbidities
Elixhauser originally devleoped this set of co-morbidities to predict long term mortality based on hospital ICD-9-CM coding records. The AHRQ comorbidities are an updated version of this, however the original Elixhauser have been used in many publications. The ICD-9-CM codes have changed slightly over the years.
```{r elix}
names(elixComorbid)
```

## Quan
Quan's paper looked at indices using both ICD-10 and ICD-9-CM. Quan generated updated ICD-9-CM codes for all 30 of Elixhauser and all 17 of Charlson/Deyo's co-morbidities. Thus there are two 'Quan' comorbidity mappings.
```{r quanElix}
names(quanDeyoComorbid)
names(quanElixComorbid)
```
